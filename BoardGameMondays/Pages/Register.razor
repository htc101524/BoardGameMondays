@page "/register"

@using Microsoft.AspNetCore.WebUtilities

@inject NavigationManager Navigation

<h1>Sign up</h1>

<form method="post" action="/account/register">
    <AntiforgeryToken />
    <div class="mb-2">
        <label class="form-label" for="register-username">Username</label>
        <input id="register-username" name="UserName" class="form-control" autocomplete="username" />
    </div>

    <div class="mb-2">
        <label class="form-label" for="register-displayname">Name</label>
        <input id="register-displayname" name="DisplayName" class="form-control" autocomplete="name" />
    </div>

    <div class="mb-2">
        <label class="form-label" for="register-password">Password</label>
        <input id="register-password" name="Password" class="form-control" type="password" autocomplete="new-password" />
    </div>

    <div class="mb-3">
        <label class="form-label" for="register-confirm">Confirm password</label>
        <input id="register-confirm" name="ConfirmPassword" class="form-control" type="password" autocomplete="new-password" />
    </div>

    <button type="submit" class="btn btn-primary">Create account</button>
    <a class="btn btn-link" href="/login">Back to login</a>

    @if (!string.IsNullOrWhiteSpace(_error))
    {
        <div class="text-danger mt-3">@_error</div>
    }
</form>

@code {
    private string? _error;

    protected override void OnParametersSet()
    {
        var uri = Navigation.ToAbsoluteUri(Navigation.Uri);
        var query = QueryHelpers.ParseQuery(uri.Query);
        _error = query.TryGetValue("error", out var error) ? error.ToString() : null;
    }
}

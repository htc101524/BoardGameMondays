@page "/reset-password"

@using Microsoft.AspNetCore.WebUtilities
@inject NavigationManager Navigation

<h1>Reset password</h1>

@if (string.IsNullOrWhiteSpace(_email) || string.IsNullOrWhiteSpace(_token))
{
    <div class="alert alert-danger" role="alert">The reset link is missing or invalid.</div>
    <a class="btn btn-link" href="/login">Back to login</a>
}
else
{
    <form method="post" action="/account/reset" data-enhance="false">
        <AntiforgeryToken />
        <input type="hidden" name="Email" value="@_email" />
        <input type="hidden" name="Token" value="@_token" />

        <div class="mb-3">
            <label class="form-label" for="reset-password">New password</label>
            <input id="reset-password" name="Password" class="form-control" type="password" autocomplete="new-password" />
        </div>

        <div class="mb-3">
            <label class="form-label" for="reset-confirm">Confirm password</label>
            <input id="reset-confirm" name="ConfirmPassword" class="form-control" type="password" autocomplete="new-password" />
        </div>

        <button type="submit" class="btn btn-primary">Reset password</button>
        <a class="btn btn-link" href="/login">Back to login</a>

        @if (!string.IsNullOrWhiteSpace(_error))
        {
            <div class="text-danger mt-3">@_error</div>
        }
    </form>
}

@code {
    private string? _email;
    private string? _token;
    private string? _error;

    protected override void OnParametersSet()
    {
        var uri = Navigation.ToAbsoluteUri(Navigation.Uri);
        var query = QueryHelpers.ParseQuery(uri.Query);
        _email = query.TryGetValue("email", out var email) ? email.ToString() : null;
        _token = query.TryGetValue("token", out var token) ? token.ToString() : null;
        _error = query.TryGetValue("error", out var error) ? error.ToString() : null;
    }
}
